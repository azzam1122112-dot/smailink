{# components/_user_card.html â€“ Ù†Ø³Ø®Ø© Ù…ÙØ­Ø³Ù‘Ù†Ø© 2025-11-11 #}
{# Ø®ÙŠØ§Ø±Ø§Øª include:
   - context_msg: Ù†Øµ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (ÙŠÙÙ…Ø±Ù‘ÙØ± Ø¹Ø¨Ø± urlencode) â€“ Ø§ÙØªØ±Ø§Ø¶ÙŠ: "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø¨Ø®ØµÙˆØµ Ø·Ù„Ø¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµÙ‘Ø©"
   - show_actions: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø± (True/False) â€“ Ø§ÙØªØ±Ø§Ø¶ÙŠ: True
   - accent: Ø³ÙÙ…Ø© Ù„ÙˆÙ†ÙŠØ© 'indigo'/'emerald'/'sky'/'rose'/'amber'/'violet'â€¦ â€“ Ø§ÙØªØ±Ø§Ø¶ÙŠ: 'indigo'
#}

{% with _show_actions=show_actions|default_if_none:True %}
{% with _context_msg=context_msg|default:"Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø¨Ø®ØµÙˆØµ Ø·Ù„Ø¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµÙ‘Ø©" %}
{% with _uid="uc-"|add:(user.id|default:user.email|default:"x")|slugify %}
{% with _accent=accent|default:"indigo" %}

{# ØªØ¹ÙŠÙŠÙ† Ø¯Ø±Ø¬Ø§Øª Ù„ÙˆÙ†ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù€ accent (Tailwind classes) #}
{% if _accent == "emerald" %}
  {% with _from="from-emerald-50" _to="to-teal-50" _badge="bg-emerald-100 text-emerald-700" _pill="bg-emerald-600 hover:bg-emerald-700" %}
{% elif _accent == "sky" %}
  {% with _from="from-sky-50" _to="to-cyan-50" _badge="bg-sky-100 text-sky-700" _pill="bg-sky-600 hover:bg-sky-700" %}
{% elif _accent == "rose" %}
  {% with _from="from-rose-50" _to="to-amber-50" _badge="bg-rose-100 text-rose-700" _pill="bg-rose-600 hover:bg-rose-700" %}
{% elif _accent == "amber" %}
  {% with _from="from-amber-50" _to="to-yellow-50" _badge="bg-amber-100 text-amber-700" _pill="bg-amber-600 hover:bg-amber-700" %}
{% elif _accent == "violet" %}
  {% with _from="from-violet-50" _to="to-fuchsia-50" _badge="bg-violet-100 text-violet-700" _pill="bg-violet-600 hover:bg-violet-700" %}
{% else %}
  {# indigo Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ #}
  {% with _from="from-indigo-50" _to="to-sky-50" _badge="bg-indigo-100 text-indigo-700" _pill="bg-indigo-600 hover:bg-indigo-700" %}
{% endif %}

<div id="{{ _uid }}"
     class="rounded-2xl border bg-white/70 dark:bg-slate-800/70 backdrop-blur shadow-glass-lg overflow-hidden rtl"
     data-component="user-card"
     dir="rtl" role="region" aria-label="Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">

  <!-- Ø±Ø£Ø³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
  <div class="px-5 py-4 bg-gradient-to-l {{ _from }} {{ _to }} dark:from-slate-800 dark:to-slate-700 border-b">
    <div class="flex items-center gap-3">
      <!-- Ø£ÙØ§ØªØ§Ø± -->
      <div class="relative shrink-0">
        {% if user.avatar_url %}
          <img src="{{ user.avatar_url }}"
               alt="ØµÙˆØ±Ø© {{ user.name|default:user.email|default:'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' }}"
               class="h-12 w-12 rounded-full ring-2 ring-white object-cover"
               loading="lazy" referrerpolicy="no-referrer" decoding="async">
        {% else %}
          <div class="h-12 w-12 rounded-full {{ _pill|cut:' hover:bg-' }} text-white grid place-items-center text-lg font-bold select-none"
               aria-hidden="true">
            {% if user.name %}{{ user.name|first }}{% else %}ğŸ‘¤{% endif %}
          </div>
        {% endif %}
        {# Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Ù„Ùˆ Ù…Ø±Ø±Øª user.is_online) #}
        {% if user.is_online %}
          <span class="absolute -bottom-0.5 -left-0.5 h-3.5 w-3.5 rounded-full bg-emerald-500 ring-2 ring-white dark:ring-slate-800"
                title="Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†" aria-label="Ù…ØªØµÙ„"></span>
        {% endif %}
      </div>

      <!-- Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¯ÙˆØ± -->
      <div class="min-w-0">
        <div class="flex items-center gap-2 flex-wrap">
          <h3 class="text-slate-900 dark:text-white font-extrabold text-base md:text-lg truncate">
            {{ user.name|default:user.email|default:"Ù…Ø³ØªØ®Ø¯Ù…" }}
          </h3>
          {% if user.role %}
            <span class="px-2 py-0.5 rounded-xl text-[11px] md:text-xs bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200">
              {{ user.role }}
            </span>
          {% endif %}
          {% if user.is_verified %}
            <span class="inline-flex items-center px-1.5 py-0.5 rounded-lg text-[11px] md:text-xs {{ _badge }}">
              ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ âœ“
            </span>
          {% endif %}
        </div>
        {% if user.email %}
          <p class="text-slate-600 dark:text-slate-300 text-xs md:text-sm truncate">{{ user.email }}</p>
        {% else %}
          <p class="text-slate-500 dark:text-slate-400 text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù‘Ù„</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Ø¬Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
  <div class="p-5 space-y-4">
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900/40 border dark:border-slate-700">
        <div class="text-xs text-slate-500 dark:text-slate-400">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
        <div class="mt-0.5 font-medium text-slate-800 dark:text-slate-100 break-all">
          {{ user.email|default:"â€” ØºÙŠØ± Ù…ØªÙˆÙØ± â€”" }}
        </div>
      </div>

      <div class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900/40 border dark:border-slate-700">
        <div class="text-xs text-slate-500 dark:text-slate-400">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</div>
        <div class="mt-0.5 font-medium text-slate-800 dark:text-slate-100">
          {% if user.phone %}{{ user.phone }}{% else %}â€” ØºÙŠØ± Ù…ØªÙˆÙØ± â€”{% endif %}
        </div>
      </div>

      {% if user.company %}
      <div class="p-3 rounded-xl bg-slate-50 dark:bg-slate-900/40 border dark:border-slate-700 sm:col-span-2">
        <div class="text-xs text-slate-500 dark:text-slate-400">Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</div>
        <div class="mt-0.5 font-medium text-slate-800 dark:text-slate-100">
          {{ user.company }}
        </div>
      </div>
      {% endif %}
    </div>

    {% if _show_actions %}
    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ -->
    <div class="flex flex-wrap items-center gap-2" role="group" aria-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„">
      {% if user.email %}
        <a href="mailto:{{ user.email }}"
           class="px-3 py-2 rounded-xl border dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-100"
           rel="noopener noreferrer">
          Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        </a>

        <button type="button"
                class="px-3 py-2 rounded-xl border dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-100"
                data-copy="{{ user.email }}"
                aria-label="Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
          Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯
        </button>
      {% endif %}

      {% if user.phone %}
        {# ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ± â€“ ÙŠÙØ®ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆÙŠØ·Ø¨Ù‘Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© #}
        <a href="{% url 'core:whatsapp_user' user.id %}?msg={{ _context_msg|urlencode }}"
           class="px-3 py-2 rounded-xl {{ _pill }} text-white"
           data-wp-msg="{{ _context_msg }}"
           rel="noopener noreferrer">
          ÙˆØ§ØªØ³Ø§Ø¨
        </a>

        <a href="tel:{{ user.phone|urlencode }}"
           class="px-3 py-2 rounded-xl border dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-100"
           rel="noopener noreferrer">
          Ø§ØªØµØ§Ù„
        </a>

        <button type="button"
                class="px-3 py-2 rounded-xl border dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-100"
                data-copy="{{ user.phone }}"
                aria-label="Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
          Ù†Ø³Ø® Ø§Ù„Ø¬ÙˆØ§Ù„
        </button>
      {% else %}
        <span class="px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs">
          Ù„Ø§ ÙŠØªÙˆÙØ± Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨
        </span>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>

<!-- Ø³ÙƒØ±Ø¨Øª Ø°Ø§ØªÙŠ Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
<script>
(function () {
  var root = document.getElementById('{{ _uid }}');
  if (!root) return;

  // Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ø¶Ø¯ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±Ø¨Ø·
  if (root.dataset.bound === '1') return;
  root.dataset.bound = '1';

  // Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ù…Ø¹ fallback Ø¢Ù…Ù†
  var btns = root.querySelectorAll('[data-copy]');
  function toast(msg) {
    var t = document.createElement('div');
    t.textContent = msg || '';
    t.setAttribute('role', 'status');
    t.setAttribute('aria-live', 'polite');
    t.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-sm px-3 py-1.5 rounded-xl shadow z-[60]';
    document.body.appendChild(t);
    setTimeout(function(){ if (t && t.parentNode) t.parentNode.removeChild(t); }, 1400);
  }

  btns.forEach(function (btn) {
    btn.addEventListener('click', function () {
      var val = btn.getAttribute('data-copy') || '';
      if (!val) return;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(val).then(function () {
          toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“');
        }).catch(function () {
          fallback();
        });
      } else {
        fallback();
      }

      function fallback() {
        try {
          var ta = document.createElement('textarea');
          ta.value = val;
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          if (ta && ta.parentNode) ta.parentNode.removeChild(ta);
          toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“');
        } catch (e) {
          toast('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù†Ø³Ø®');
        }
      }
    }, { passive: true });
  });
})();
</script>

{% endwith %} {# _from/_to/_badge/_pill #}
{% endwith %} {# _accent #}
{% endwith %} {# _uid #}
{% endwith %} {# _context_msg #}
{% endwith %} {# _show_actions #}
