{% extends "base.html" %}
{% load static %}

{% block title %}Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª â€” Ø³Ø§Ù…ÙŠ Ù„ÙŠÙ†Ùƒ{% endblock %}

{% block content %}
<section class="page-section notifications-page">
  <div class="container">
    
    {# ===== Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ===== #}
    <div class="section-header" style="text-align: right; margin-bottom: 2rem;">
      <div class="section-badge">
        ğŸ”” Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
      </div>
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-top: 1rem;">
        <div>
          <h1 class="section-title">
            Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
          </h1>
          <p class="section-description">
            ÙƒÙ„ Ù…Ø§ ÙŠÙ‡Ù…Ùƒ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª
          </p>
        </div>
        <div class="header-actions employee-actions">
          <a href="{% url 'notifications:mark_all_read' %}" class="btn btn-outline">
            ğŸ‘ï¸ ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡
          </a>
          <a href="{% url 'notifications:delete_all' %}" class="btn btn-danger" 
             onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§ØªØŸ');">
            ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„
          </a>
        </div>
      </div>
    </div>

    {# ===== ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ÙÙ„Ø§ØªØ± ===== #}
    <div class="filter-tabs profile-section" style="margin-bottom: 2rem;">
      <div class="tabs-container employee-actions">
        {% with status_q=status_q|default:"all" %}
          <a href="{% url 'notifications:list' %}?status=all" 
             class="btn btn-sm {% if status_q == 'all' %}btn-primary{% else %}btn-outline{% endif %}">
            Ø§Ù„ÙƒÙ„
          </a>
          <a href="{% url 'notifications:list' %}?status=unread" 
             class="btn btn-sm {% if status_q == 'unread' %}btn-primary{% else %}btn-outline{% endif %}">
            ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©
          </a>
          <a href="{% url 'notifications:list' %}?status=read" 
             class="btn btn-sm {% if status_q == 'read' %}btn-primary{% else %}btn-outline{% endif %}">
            Ù…Ù‚Ø±ÙˆØ¡Ø©
          </a>
        {% endwith %}
      </div>
    </div>

    {# ===== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ===== #}
    {% if page_obj.object_list %}
      <div class="notifications-grid employees-grid">
        {% for n in page_obj.object_list %}
          <div class="employee-card scroll-reveal {% if not n.is_read %}notif-unread{% else %}notif-read{% endif %}">
            
            {# Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ #}
            <div class="status-indicator {% if not n.is_read %}status-unread{% else %}status-read{% endif %}"></div>

            <div class="employee-card-header">
              <div class="notification-icon" style="width: 3rem; height: 3rem; border-radius: var(--radius-lg); background: linear-gradient(135deg, var(--primary-500), var(--primary-700)); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                ğŸ””
              </div>
              <div class="employee-basic-info">
                <div class="employee-name">
                  <a href="{% url 'notifications:detail' n.id %}" class="notification-title">
                    {{ n.title|default:"ØªÙ†Ø¨ÙŠÙ‡" }}
                  </a>
                </div>
                <div class="employee-title">
                  <span class="badge {% if not n.is_read %}badge-pending{% else %}badge-verified{% endif %}">
                    {% if not n.is_read %}ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡{% else %}Ù…Ù‚Ø±ÙˆØ¡{% endif %}
                  </span>
                </div>
                <div class="employee-location">
                  <span>{{ n.created_at|date:"Y-m-d H:i" }}</span>
                </div>
              </div>
            </div>

            {# Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ #}
            {% if n.body %}
              <div class="employee-skills">
                <div class="notification-body">
                  {{ n.body|truncatewords:30 }}
                </div>
              </div>
            {% endif %}

            {# Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª #}
            <div class="employee-actions">
              {% if n.url %}
                <a href="{% url 'notifications:detail' n.id %}" class="btn-view-profile">
                  ğŸ”— ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·
                </a>
              {% else %}
                <a href="{% url 'notifications:detail' n.id %}" class="btn-view-profile">
                  ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                </a>
              {% endif %}

              {% if not n.is_read %}
                <a href="{% url 'notifications:mark_read' n.id %}?next={{ request.get_full_path|urlencode }}" 
                   class="btn-contact" title="ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡">
                  âœ… Ù‚Ø±Ø§Ø¡Ø©
                </a>
              {% else %}
                <span class="btn-contact" style="opacity: 0.6; cursor: default;" title="ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©">
                  âœ… Ù…Ù‚Ø±ÙˆØ¡
                </span>
              {% endif %}
            </div>

            {# Ø£Ø²Ø±Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØ© #}
            <div class="notification-actions employee-actions" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--dark-100);">
              <a href="{% url 'notifications:delete' n.id %}?next={{ request.get_full_path|urlencode }}" 
                 class="btn btn-danger btn-sm"
                 onclick="return confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ØŸ');">
                ğŸ—‘ï¸ Ø­Ø°Ù
              </a>
              
              {% if not n.is_read %}
                <a href="{% url 'notifications:mark_read' n.id %}?next={{ request.get_full_path|urlencode }}" 
                   class="btn btn-outline btn-sm">
                  âœ… ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡
                </a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      {# ===== ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª ===== #}
      {% if page_obj.paginator.num_pages > 1 %}
        <div class="pagination profile-section" style="text-align: center; padding: 1.5rem;">
          <div class="pagination-inner employee-actions">
            {% if page_obj.has_previous %}
              <a class="btn btn-outline btn-sm"
                 href="?page={{ page_obj.previous_page_number }}&status={{ status_q }}">
                â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
              </a>
            {% else %}
              <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
            {% endif %}

            <span class="pagination-info badge badge-default">
              Ø§Ù„ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
              <a class="btn btn-outline btn-sm"
                 href="?page={{ page_obj.next_page_number }}&status={{ status_q }}">
                Ø§Ù„ØªØ§Ù„ÙŠ â€º
              </a>
            {% else %}
              <span class="btn btn-outline btn-sm" style="opacity: 0.5; cursor: not-allowed;">Ø§Ù„ØªØ§Ù„ÙŠ â€º</span>
            {% endif %}
          </div>
        </div>
      {% endif %}

    {% else %}
      {# ===== Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ===== #}
      <div class="empty-state profile-section text-center" style="padding: 4rem 2rem; background: var(--dark-50); border: 2px dashed var(--dark-300);">
        <div class="empty-icon" style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.5;">ğŸ“­</div>
        <h3 class="card-section-title" style="margin-bottom: 1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
        <p class="card-section-note" style="font-size: 1rem;">
          Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø¬Ø¯ÙŠØ¯ Ø³Ù†Ø¹Ø±Ø¶Ù‡ Ù„Ùƒ Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
        </p>
      </div>
    {% endif %}

    {# ===== Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© ===== #}
    <div class="stats-section profile-section" style="background: var(--dark-50); margin-top: 2rem;">
      <div class="card-section-title">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
      <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="stat-item">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
          <div class="stat-number">{{ page_obj.paginator.count }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
          <div class="stat-number" style="color: var(--primary-600);">
            {% with unread_count=0 %}
              {% for n in page_obj.object_list %}{% if not n.is_read %}{% with unread_count=unread_count|add:1 %}{% endwith %}{% endif %}{% endfor %}
              {{ unread_count }}
            {% endwith %}
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
          <div class="stat-number" style="color: var(--dark-600);">
            {% with read_count=0 %}
              {% for n in page_obj.object_list %}{% if n.is_read %}{% with read_count=read_count|add:1 %}{% endwith %}{% endif %}{% endfor %}
              {{ read_count }}
            {% endwith %}
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ±
    if (typeof initScrollReveal === 'function') {
      initScrollReveal();
    }

    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    if (typeof initEmployeeCards === 'function') {
      initEmployeeCards();
    }

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
    document.querySelectorAll('.btn').forEach(button => {
      button.addEventListener('click', function() {
        if (typeof animateButtonClick === 'function') {
          animateButtonClick(this);
        }
      });
    });

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
    document.querySelectorAll('.notif-unread').forEach(card => {
      card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px)';
        this.style.boxShadow = 'var(--shadow-lg)';
      });
      
      card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '';
      });

      // ØªØ£Ø«ÙŠØ± ÙˆÙ…ÙŠØ¶ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
      if (!this.classList.contains('animated')) {
        this.style.animation = 'pulseGlow 2s infinite';
        this.classList.add('animated');
      }
    });

    // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    const filterTabs = document.querySelector('.tabs-container');
    if (filterTabs) {
      const tabs = filterTabs.querySelectorAll('.btn');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = 'scale(1)';
          }, 150);
        });
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ø´ÙƒÙ„ Ø­ÙŠÙˆÙŠ
    function updateNotificationCounts() {
      const unreadCards = document.querySelectorAll('.notif-unread').length;
      const totalCards = document.querySelectorAll('.employee-card').length;
      const readCards = totalCards - unreadCards;
      
      // ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
      console.log(`Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª: ${unreadCards} ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©, ${readCards} Ù…Ù‚Ø±ÙˆØ¡Ø©`);
    }

    // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    updateNotificationCounts();

  })();
  </script>

  <style>
  .notifications-page .notifications-grid {
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  }

  .notifications-page .employee-card {
    position: relative;
    min-height: 280px;
    transition: all 0.3s ease;
  }

  .notifications-page .notif-unread {
    background: linear-gradient(135deg, var(--primary-50) 0%, var(--white) 100%);
    border-left: 4px solid var(--primary-500);
  }

  .notifications-page .notif-read {
    background: var(--white);
    opacity: 0.9;
  }

  .notifications-page .status-indicator {
    position: absolute;
    top: 0;
    right: 0;
    width: 4px;
    height: 100%;
    border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
  }

  .notifications-page .status-unread {
    background: var(--primary-500);
    animation: pulse 2s infinite;
  }

  .notifications-page .status-read {
    background: var(--dark-400);
  }

  .notifications-page .notification-title {
    color: var(--dark-900);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .notifications-page .notification-title:hover {
    color: var(--primary-600);
    text-decoration: underline;
  }

  .notifications-page .notification-body {
    color: var(--dark-600);
    font-size: 0.95rem;
    line-height: 1.5;
    max-height: 4.5em;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
  }

  .notifications-page .notification-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
  }

  .notifications-page .header-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .notifications-page .filter-tabs .tabs-container {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .notifications-page .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .notifications-page .stat-item {
    text-align: center;
    padding: 1rem;
    background: var(--white);
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
  }

  .notifications-page .stat-label {
    font-size: 0.875rem;
    color: var(--dark-600);
    margin-bottom: 0.5rem;
  }

  .notifications-page .stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-600);
  }

  .notifications-page .empty-state {
    border: 2px dashed var(--dark-300);
  }

  @media (max-width: 1024px) {
    .notifications-page .notifications-grid {
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .notifications-page .header-actions {
      flex-direction: column;
      width: 100%;
      margin-top: 1rem;
    }
    
    .notifications-page .header-actions .btn {
      width: 100%;
    }
    
    .notifications-page .notifications-grid {
      grid-template-columns: 1fr;
    }
    
    .notifications-page .filter-tabs .tabs-container {
      flex-direction: column;
    }
    
    .notifications-page .filter-tabs .btn {
      width: 100%;
    }
    
    .notifications-page .notification-actions {
      flex-direction: column;
    }
    
    .notifications-page .employee-actions {
      flex-direction: column;
    }
    
    .notifications-page .btn-contact {
      width: 100%;
    }
  }

  @media (max-width: 480px) {
    .notifications-page .employee-card-header {
      flex-direction: column;
      text-align: center;
    }
    
    .notifications-page .notification-icon {
      align-self: center;
    }
    
    .notifications-page .stats-grid {
      grid-template-columns: 1fr;
    }
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
  @keyframes pulseGlow {
    0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
    100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .notifications-page .scroll-reveal {
    animation: slideInRight 0.6s ease-out;
  }
  </style>
{% endblock %}