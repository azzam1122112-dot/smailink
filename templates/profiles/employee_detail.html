{% extends "base.html" %}
{% load static %}

{% block title %}{{ emp.user.name|default:"Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ØªÙ‚Ù†ÙŠ" }} - Ø³Ø§Ù…ÙŠ Ù„ÙŠÙ†Ùƒ{% endblock %}

{% block content %}
<div class="employee-profile">
  <!-- Ø±Ø£Ø³ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ -->
  <div class="profile-header scroll-reveal">
    <div class="profile-avatar">
      <img
        src="{% if emp.photo %}{{ emp.photo.url }}{% else %}{% static 'img/avatar-placeholder.png' %}{% endif %}"
        alt="ØµÙˆØ±Ø© {{ emp.user.name }}"
        loading="lazy">
    </div>
    
    <div class="profile-info">
      <h1 class="profile-name">{{ emp.user.name|default:"ØªÙ‚Ù†ÙŠ" }}</h1>
      <div class="profile-title">
        {% if emp.title %}{{ emp.title }}{% elif emp.specialty %}{{ emp.specialty }}{% else %}ØªÙ‚Ù†ÙŠ Ù…Ø¹ØªÙ…Ø¯{% endif %}
      </div>
      
      {% if emp.city %}
      <div class="profile-location">
        <span>ğŸ“</span>
        <span>{{ emp.city }}</span>
      </div>
      {% endif %}
      
      <div class="profile-stats">
        <div class="profile-stat">
          <span class="profile-rating">
            â˜… {{ emp.rating|floatformat:1 }}
          </span>
          <span>({{ emp.reviews_count }} ØªÙ‚ÙŠÙŠÙ…)</span>
        </div>
        
        <div class="profile-stat">
          <span>âœ… {{ emp.completed_jobs }} Ù…Ø´Ø±ÙˆØ¹ Ù…ÙƒØªÙ…Ù„</span>
        </div>
      </div>
      
      <!-- Ø­Ø§Ù„Ø© KYC -->
      <div class="kyc-status">
        {% if emp.kyc_status == 'verified' %}
          <span class="badge badge-verified">âœ… KYC Ù…ÙˆØ«Ù‘Ù‚</span>
        {% elif emp.kyc_status == 'pending' %}
          <span class="badge badge-pending">â³ KYC Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
        {% elif emp.kyc_status == 'rejected' %}
          <span class="badge badge-rejected">âŒ KYC Ù…Ø±ÙÙˆØ¶</span>
        {% else %}
          <span class="badge badge-default">â„¹ï¸ Ø¨Ø¯ÙˆÙ† ØªÙˆØ«ÙŠÙ‚</span>
        {% endif %}
        
        {% if emp.kyc_verified_at %}
          <span class="text-sm text-slate-500">Ù…ÙˆØ«Ù‘Ù‚ Ù…Ù†Ø° {{ emp.kyc_verified_at|date:"Y-m-d" }}</span>
        {% endif %}
      </div>
    </div>
    
    <div class="profile-actions">
      {% if wa_redirect_url %}
        <a href="{{ wa_redirect_url }}" class="btn btn-primary contact-button" rel="nofollow">
          ğŸ“ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        </a>
      {% else %}
        <button class="btn btn-secondary contact-button contact-disabled" title="Ù…ÙˆÙ‚ÙˆÙ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…Ù†ØµØ©">
          ğŸ“ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        </button>
      {% endif %}
      
      {% if masked_phone %}
        <div class="phone-info">Ø§Ù„Ø¬ÙˆØ§Ù„: {{ masked_phone }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© -->
  {% if emp.bio %}
  <section class="profile-section bio-section scroll-reveal">
    <h2 class="section-title">Ù†Ø¨Ø°Ø© Ø¹Ù†ÙŠ</h2>
    <div class="bio-content">
      <p class="leading-relaxed whitespace-pre-line text-slate-700">{{ emp.bio }}</p>
    </div>
  </section>
  {% endif %}

  <!-- Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª ÙˆØ§Ù„Ù…Ù‡Ø§Ø±Ø§Øª -->
  <div class="grid md:grid-cols-3 gap-6">
    <!-- Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª -->
    <section class="profile-section scroll-reveal">
      <h2 class="section-title">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value">{{ emp.completed_jobs }}</div>
          <div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙƒØªÙ…Ù„Ø©</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-value">{{ emp.avg_response_minutes }}</div>
          <div class="stat-label">Ø¯Ù‚ÙŠÙ‚Ø© Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-value">{{ emp.client_satisfaction|floatformat:0 }}%</div>
          <div class="stat-label">Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
        </div>
        
        {% if emp.hourly_rate %}
        <div class="stat-card">
          <div class="stat-value">{{ emp.hourly_rate|floatformat:2 }}</div>
          <div class="stat-label">Ø±ÙŠØ§Ù„/Ø³Ø§Ø¹Ø©</div>
        </div>
        {% endif %}
      </div>
    </section>

    <!-- Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª -->
    <section class="profile-section md:col-span-2 scroll-reveal">
      <h2 class="section-title">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØ®ØµØµØ§Øª</h2>
      {% if emp.skills_list %}
        <div class="skills-container">
          {% for skill in emp.skills_list %}
            <span class="skill-tag">{{ skill }}</span>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ø±Ø§Øª Ù…Ø¯Ø®Ù„Ø©.</p>
      {% endif %}
    </section>
  </div>

  <!-- Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© -->
  {% if completed_requests_count %}
  <section class="profile-section scroll-reveal">
    <h2 class="section-title">
      Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© Ø¹Ø¨Ø± Ø³Ø§Ù…ÙŠ Ù„ÙŠÙ†Ùƒ
      <span class="text-sm font-normal text-slate-500">({{ completed_requests_count }})</span>
    </h2>
    
    <div class="projects-grid">
      {% for req in completed_requests %}
      <div class="project-card">
        <div class="project-info">
          <h3 class="project-title">{{ req.title|default:"Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" }}</h3>
          <div class="project-meta">
            {% if req.client %}
            <div class="meta-item">
              <span>ğŸ‘¤</span>
              <span>
                {% if req.client.name %}
                  {{ req.client.name }}
                {% else %}
                  {{ req.client.email }}
                {% endif %}
              </span>
            </div>
            {% endif %}
            
            {% if req.completed_at %}
            <div class="meta-item">
              <span>ğŸ“…</span>
              <span>{{ req.completed_at|date:"Y-m-d" }}</span>
            </div>
            {% else %}
            <div class="meta-item">
              <span>ğŸ“…</span>
              <span>{{ req.created_at|date:"Y-m-d" }}</span>
            </div>
            {% endif %}
            
            {% if req.category %}
            <div class="meta-item">
              <span>ğŸ·ï¸</span>
              <span>{{ req.get_category_display|default:req.category }}</span>
            </div>
            {% endif %}
          </div>
        </div>
        
        <div class="project-status">
          <span class="status-badge status-completed">Ù…ÙƒØªÙ…Ù„</span>
          <a href="{% url 'marketplace:request_detail' req.pk %}" class="text-sm text-primary-600 hover:text-primary-700">
            Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ -->
  <section class="profile-section scroll-reveal">
    <h2 class="section-title">
      Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
      <span class="text-sm font-normal text-slate-500">(ÙŠÙØ¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·)</span>
    </h2>
    
    <div class="portfolio-grid">
      {% for item in emp.user.portfolio_items.all %}
        {% if item.is_public %}
        <div class="portfolio-item">
          {% if item.image %}
          <div class="portfolio-image">
            <img src="{{ item.image.url }}" alt="{{ item.title }}" loading="lazy">
          </div>
          {% endif %}
          
          <div class="portfolio-content">
            <h3 class="portfolio-title">{{ item.title }}</h3>
            
            {% if item.tags_list %}
            <div class="portfolio-tags">
              {% for tag in item.tags_list|slice:":5" %}
                <span class="portfolio-tag">{{ tag }}</span>
              {% endfor %}
            </div>
            {% endif %}
            
            {% if item.description %}
            <p class="portfolio-description">{{ item.description }}</p>
            {% endif %}
            
            <div class="portfolio-actions">
              {% if item.link %}
              <a href="{{ item.link }}" target="_blank" rel="noopener" class="text-sm text-primary-600 hover:text-primary-700">
                ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·
              </a>
              {% endif %}
              
              {% if item.attachment %}
              <a href="{{ item.attachment.url }}" class="text-sm text-slate-600 hover:text-slate-700">
                ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
              </a>
              {% endif %}
            </div>
          </div>
        </div>
        {% endif %}
      {% empty %}
      <div class="col-span-full text-center py-8">
        <p class="text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„.</p>
      </div>
      {% endfor %}
    </div>
  </section>
</div>
{% endblock %}