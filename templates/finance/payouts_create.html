{# finance/templates/finance/payouts_create.html #}
{% extends "base.html" %}

{% block title %}Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØµØ±Ù{% endblock %}

{% block content %}
<section class="page-section payout-create-page">
  <div class="container">
    
    {# ===== Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ===== #}
    <div class="section-header" style="text-align: right; margin-bottom: 2rem;">
      <div class="section-badge">
        ğŸ’¸ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØµØ±Ù
      </div>
      <h1 class="section-title">
        Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØµØ±Ù
      </h1>
      <p class="section-description">
        Ø¥Ù†Ø´Ø§Ø¡ ØµØ±Ù Ù„ØµØ§ÙÙŠ Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµÙ‘Ø©)
      </p>
    </div>

    {# ===== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ===== #}
    <div class="profile-section" style="max-width: 600px; margin: 0 auto;">
      
      {# ===== ØªÙ†Ø¨ÙŠÙ‡ ØªØ¬Ø±ÙŠØ¨ÙŠ ===== #}
      <div class="demo-alert profile-section" style="background: var(--secondary-50); border-color: var(--secondary-200); margin-bottom: 1.5rem;">
        <div class="card-row" style="display: flex; align-items: flex-start; gap: 1rem;">
          <span class="alert-icon" style="color: var(--secondary-600); font-size: 1.2rem;">ğŸ§ª</span>
          <div class="alert-content">
            <div class="card-section-title" style="color: var(--secondary-700); margin-bottom: 0.25rem;">
              Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ
            </div>
            <p class="card-section-note" style="color: var(--secondary-600);">
              Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ¶ÙŠØ­ÙŠ ÙˆØ³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ view Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø³Ø§Ø±
            </p>
          </div>
        </div>
      </div>

      {# ===== ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø§Ù„ÙŠ Ù…Ù‡Ù… ===== #}
      <div class="profile-section" style="background: var(--primary-50); border-color: var(--primary-200); margin-bottom: 2rem;">
        <div class="card-row" style="display: flex; align-items: flex-start; gap: 1rem;">
          <span style="font-size: 1.2rem;">ğŸ’¡</span>
          <div>
            <div class="card-section-title" style="color: var(--primary-700); margin-bottom: 0.25rem;">
              ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø§Ù„ÙŠ
            </div>
            <p class="card-section-note" style="color: var(--primary-700);">
              Ù…Ø¨Ù„Øº Ø£Ù…Ø± Ø§Ù„ØµØ±Ù ÙŠÙ…Ø«Ù„ <b>ØµØ§ÙÙŠ Ø§Ù„Ù…ÙˆØ¸Ù</b> Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµÙ‘Ø©.
              <br>
              <span style="color: var(--dark-600); font-weight: 600;">
                Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø§ ÙŠØªØ­Ù…Ù„ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµÙ‘Ø©ØŒ ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ØªÙØ­ØµÙ‘Ù„ Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¶Ù…Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆÙ„ÙŠØ³ Ø¶Ù…Ù† Ø§Ù„ØµØ±Ù.
              </span>
            </p>
          </div>
        </div>
      </div>

      <form method="post" class="payout-form" id="payoutForm">
        {% csrf_token %}

        <div class="form-grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
          
          {# ===== Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆØ¸Ù ===== #}
          <div class="form-field">
            <label class="form-label">
              ğŸ‘¤ Ø§Ù„Ù…ÙˆØ¸Ù
            </label>
            <input type="text" 
                   name="employee" 
                   class="input"
                   placeholder="Ø§Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù"
                   required
                   id="employeeInput">
            <p class="field-hint">
              ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            </p>
          </div>

          {# ===== Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ===== #}
          <div class="form-field">
            <label class="form-label">
              ğŸ’° Ù…Ø¨Ù„Øº Ø§Ù„ØµØ±Ù (ØµØ§ÙÙŠ Ø§Ù„Ù…ÙˆØ¸Ù)
            </label>
            <div class="amount-input-wrapper">
              <input type="number" 
                     step="0.01" 
                     min="0"
                     name="amount" 
                     class="input"
                     placeholder="0.00"
                     required
                     id="amountInput">
              <span class="currency-symbol">Ø±.Ø³</span>
            </div>
            <p class="field-hint">
              Ø£Ø¯Ø®Ù„ ØµØ§ÙÙŠ Ù…Ø³ØªØ­Ù‚ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµÙ‘Ø©.
            </p>
          </div>
        </div>

        {# ===== Ø­Ù‚Ù„ Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ===== #}
        <div class="form-field">
          <label class="form-label">
            ğŸ“ Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          </label>
          <textarea name="description" 
                    class="input"
                    rows="3"
                    placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ø£Ù…Ø± Ø§Ù„ØµØ±Ù..."
                    id="descriptionInput"></textarea>
          <p class="field-hint">
            Ù…Ø«Ù„Ø§Ù‹: ØµØ§ÙÙŠ Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ø·Ù„Ø¨ #123 Ø£Ùˆ ØªØ³ÙˆÙŠØ© Ù…Ø³ØªØ­Ù‚Ø§Øª Ù…Ø±Ø­Ù„Ø©
          </p>
        </div>

        {# ===== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ù„Øº ===== #}
        <div class="amount-preview profile-section" style="background: var(--primary-50); border-color: var(--primary-200); margin: 1.5rem 0; display: none;" id="amountPreview">
          <div class="card-section-title" style="color: var(--primary-700);">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµØ±Ù</div>
          <div class="preview-content" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="preview-label" style="color: var(--primary-600);">ØµØ§ÙÙŠ Ø§Ù„ØµØ±Ù Ù„Ù„Ù…ÙˆØ¸Ù:</div>
            <div class="preview-amount" style="font-size: 1.5rem; font-weight: 800; color: var(--primary-700);" id="previewAmount">
              0.00 Ø±.Ø³
            </div>
          </div>
        </div>

        {# ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ===== #}
        <div class="form-actions employee-actions" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--dark-200);">
          <button type="submit" class="btn btn-primary" id="submitBtn">
            ğŸ’¾ Ø­ÙØ¸ Ø£Ù…Ø± Ø§Ù„ØµØ±Ù
          </button>
          <a href="{% url 'finance:home' %}" class="btn btn-outline">
            ğŸš« Ø¥Ù„ØºØ§Ø¡
          </a>
        </div>

      </form>
    </div>

    {# ===== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ===== #}
    <div class="help-section profile-section" style="max-width: 600px; margin: 2rem auto 0; background: var(--dark-50);">
      <div class="card-section-title">ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©</div>
      <div class="help-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="help-item">
          <div class="help-icon">â±ï¸</div>
          <div class="help-content">
            <div class="help-title">Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
            <div class="help-text">ÙŠØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØµØ±Ù Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø©</div>
          </div>
        </div>
        <div class="help-item">
          <div class="help-icon">ğŸ“‹</div>
          <div class="help-content">
            <div class="help-title">Ø§Ù„ØªØ­Ù‚Ù‚</div>
            <div class="help-text">ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ù‡Ùˆ ØµØ§ÙÙŠ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ù†ØµÙ‘Ø©</div>
          </div>
        </div>
        <div class="help-item">
          <div class="help-icon">ğŸ”’</div>
          <div class="help-content">
            <div class="help-title">Ø§Ù„Ø£Ù…Ø§Ù†</div>
            <div class="help-text">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø© ÙˆÙ…Ø¤Ù…Ù†Ø©</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
  (function () {
    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ±
    if (typeof initScrollReveal === 'function') {
      initScrollReveal();
    }

    // ØªÙ‡ÙŠØ¦Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    if (typeof initButtonEffects === 'function') {
      initButtonEffects();
    }

    const form = document.getElementById('payoutForm');
    const employeeInput = document.getElementById('employeeInput');
    const amountInput = document.getElementById('amountInput');
    const descriptionInput = document.getElementById('descriptionInput');
    const amountPreview = document.getElementById('amountPreview');
    const previewAmount = document.getElementById('previewAmount');
    const submitBtn = document.getElementById('submitBtn');

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ù„Øº
    function formatAmount(amount) {
      return new Intl.NumberFormat('ar-SA', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(amount);
    }

    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ù„Øº
    function updateAmountPreview() {
      const amount = parseFloat(amountInput.value) || 0;
      
      if (amount > 0) {
        previewAmount.textContent = `${formatAmount(amount)} Ø±.Ø³`;
        amountPreview.style.display = 'block';
        
        // ØªØ£Ø«ÙŠØ± Ø¸Ù‡ÙˆØ±
        amountPreview.style.opacity = '0';
        amountPreview.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
          amountPreview.style.opacity = '1';
          amountPreview.style.transform = 'translateY(0)';
        }, 10);
      } else {
        amountPreview.style.display = 'none';
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function validateForm() {
      const employee = employeeInput.value.trim();
      const amount = parseFloat(amountInput.value);
      
      if (!employee) {
        if (typeof showToast === 'function') {
          showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
        }
        employeeInput.focus();
        return false;
      }
      
      if (!amount || amount <= 0) {
        if (typeof showToast === 'function') {
          showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±', 'error');
        }
        amountInput.focus();
        return false;
      }
      
      return true;
    }

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ù‚ÙˆÙ„
    if (amountInput) {
      amountInput.addEventListener('input', updateAmountPreview);
      amountInput.addEventListener('focus', function() {
        this.style.borderColor = 'var(--primary-500)';
        this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
      });
      amountInput.addEventListener('blur', function() {
        this.style.borderColor = '';
        this.style.boxShadow = '';
      });
    }

    if (employeeInput) {
      employeeInput.addEventListener('focus', function() {
        this.style.borderColor = 'var(--primary-500)';
        this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
      });
      employeeInput.addEventListener('blur', function() {
        this.style.borderColor = '';
        this.style.boxShadow = '';
      });
    }

    if (descriptionInput) {
      descriptionInput.addEventListener('focus', function() {
        this.style.borderColor = 'var(--primary-500)';
        this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
      });
      descriptionInput.addEventListener('blur', function() {
        this.style.borderColor = '';
        this.style.boxShadow = '';
      });
    }

    // Ø­Ø¯Ø« Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
          return false;
        }

        const amount = parseFloat(amountInput.value);
        const employee = employeeInput.value.trim();
        
        const confirmMsg = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØµØ±Ù (ØµØ§ÙÙŠ Ø§Ù„Ù…ÙˆØ¸Ù) Ù„Ù„Ù…ÙˆØ¸Ù ${employee} Ø¨Ù…Ø¨Ù„Øº ${formatAmount(amount)} Ø±ÙŠØ§Ù„ØŸ`;
        
        if (!confirm(confirmMsg)) {
          return false;
        }

        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„ØµØ±Ù...';
          
          if (typeof animateButtonClick === 'function') {
            animateButtonClick(submitBtn);
          }
        }

        if (typeof showToast === 'function') {
          showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„ØµØ±Ù...', 'info');
        }

        // Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ
        setTimeout(() => {
          if (typeof showToast === 'function') {
            showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­ (Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ)', 'success');
          }
          
          form.reset();
          amountPreview.style.display = 'none';
          
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'ğŸ’¾ Ø­ÙØ¸ Ø£Ù…Ø± Ø§Ù„ØµØ±Ù';
          }
        }, 2000);

        return false;
      });
    }

    document.querySelectorAll('.help-item').forEach((item, index) => {
      item.style.animationDelay = `${index * 0.2}s`;
      item.classList.add('scroll-reveal');
    });

  })();
  </script>

  <style>
  .payout-create-page .form-grid-2 {
    grid-template-columns: 1fr 1fr;
  }

  .payout-create-page .form-field {
    margin-bottom: 1.5rem;
  }

  .payout-create-page .form-label {
    display: block;
    font-weight: 600;
    color: var(--dark-700);
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  .payout-create-page .input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--dark-300);
    border-radius: var(--radius-lg);
    background: var(--white);
    font-family: inherit;
    font-size: 1rem;
    transition: var(--transition);
  }

  .payout-create-page .input:focus {
    outline: none;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
  }

  .payout-create-page textarea.input {
    min-height: 80px;
    resize: vertical;
  }

  .payout-create-page .field-hint {
    color: var(--dark-500);
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .payout-create-page .amount-input-wrapper {
    position: relative;
  }

  .payout-create-page .currency-symbol {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--dark-500);
    font-weight: 600;
  }

  .payout-create-page .amount-input-wrapper .input {
    padding-left: 3rem;
  }

  .payout-create-page .amount-preview {
    transition: all 0.3s ease;
  }

  .payout-create-page .help-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .payout-create-page .help-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: var(--white);
    border-radius: var(--radius-lg);
    border: 1px solid var(--dark-200);
  }

  .payout-create-page .help-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .payout-create-page .help-content {
    flex: 1;
  }

  .payout-create-page .help-title {
    font-weight: 600;
    color: var(--dark-700);
    margin-bottom: 0.25rem;
  }

  .payout-create-page .help-text {
    color: var(--dark-600);
    font-size: 0.875rem;
    line-height: 1.4;
  }

  .payout-create-page .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-start;
  }

  @media (max-width: 768px) {
    .payout-create-page .form-grid-2 {
      grid-template-columns: 1fr;
    }
    
    .payout-create-page .form-actions {
      flex-direction: column;
    }
    
    .payout-create-page .form-actions .btn {
      width: 100%;
    }
    
    .payout-create-page .help-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .payout-create-page .help-item {
      flex-direction: column;
      text-align: center;
    }
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .payout-create-page .profile-section {
    animation: slideInUp 0.6s ease-out;
  }

  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ù…Ø¨Ø§Ù„Øº */
  @keyframes amountPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  .payout-create-page .preview-amount {
    animation: amountPulse 0.5s ease-in-out;
  }
  </style>
{% endblock %}
